<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Anonymice Chat</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="admin-body">
    <div class="admin-header">
        <h1>üê≠ Admin Dashboard</h1>
        <p>Managing up to 8 concurrent chat sessions</p>
        <div class="admin-info">
            <span>Admin: Rajendran D</span>
            <span id="activeRooms">Active Rooms: 0</span>
        </div>
    </div>

    <div class="chat-grid">
        <!-- Chat windows will be dynamically created -->
    </div>

    <div class="admin-footer">
        <p>üí° Tip: Each chat window represents one participant. Messages are not saved.</p>
    </div>

    <script>
        const socket = io();
        const chatGrid = document.querySelector('.chat-grid');
        const activeRoomsSpan = document.getElementById('activeRooms');
        
        let activeRooms = 0;
        let chatWindows = {};

        // Connect as admin
        socket.emit('admin-connect');

        socket.on('admin-connected', (data) => {
            console.log('Admin connected, existing rooms:', data.rooms);
            updateActiveRooms();
        });

        socket.on('new-participant', (data) => {
            console.log('New participant:', data);
            createChatWindow(data.roomId, data.participant);
            updateActiveRooms();
        });

        socket.on('admin-message', (data) => {
            const { roomId, message } = data;
            if (chatWindows[roomId]) {
                addMessageToWindow(roomId, message);
            }
        });

        socket.on('participant-left', (data) => {
            const { roomId, participant } = data;
            if (chatWindows[roomId]) {
                removeChatWindow(roomId);
                updateActiveRooms();
            }
        });

        function createChatWindow(roomId, participant) {
            const chatWindow = document.createElement('div');
            chatWindow.className = 'chat-window';
            chatWindow.id = `chat-${roomId}`;
            
            chatWindow.innerHTML = `
                <div class="chat-header">
                    <h3>Room ${roomId}</h3>
                    <span class="participant-name">${participant.name}</span>
                    <span class="status-indicator online">‚óè</span>
                </div>
                <div class="chat-messages" id="messages-${roomId}">
                    <div class="system-message">Chat started with ${participant.name}</div>
                </div>
                <div class="chat-input">
                    <input type="text" placeholder="Type your message..." id="input-${roomId}" maxlength="200">
                    <button onclick="sendMessage(${roomId})">Send</button>
                </div>
            `;

            chatGrid.appendChild(chatWindow);
            chatWindows[roomId] = chatWindow;

            // Join the room
            socket.emit('join-room', { roomId });

            // Handle enter key
            const input = chatWindow.querySelector(`#input-${roomId}`);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage(roomId);
                }
            });
        }

        function removeChatWindow(roomId) {
            const chatWindow = chatWindows[roomId];
            if (chatWindow) {
                chatWindow.remove();
                delete chatWindows[roomId];
            }
        }

        function addMessageToWindow(roomId, message) {
            const messagesContainer = document.getElementById(`messages-${roomId}`);
            if (!messagesContainer) return;

            const messageElement = document.createElement('div');
            messageElement.className = `message ${message.isAdmin ? 'admin-message' : 'participant-message'}`;
            
            messageElement.innerHTML = `
                <div class="message-header">
                    <span class="sender">${message.sender}</span>
                    <span class="timestamp">${message.timestamp}</span>
                </div>
                <div class="message-text">${message.text}</div>
            `;

            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage(roomId) {
            const input = document.getElementById(`input-${roomId}`);
            const message = input.value.trim();
            
            if (message) {
                socket.emit('send-message', { text: message, roomId });
                input.value = '';
            }
        }

        function updateActiveRooms() {
            activeRooms = Object.keys(chatWindows).length;
            activeRoomsSpan.textContent = `Active Rooms: ${activeRooms}`;
        }

        // Global function for button onclick
        window.sendMessage = sendMessage;
    </script>
</body>
</html> 