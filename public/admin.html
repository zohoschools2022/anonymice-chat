<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Anonymice Chat</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Admin dashboard styles - Dark Theme */
        .admin-body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .admin-header {
            background: rgba(45, 55, 72, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #e2e8f0;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .admin-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #f7fafc;
        }
        
        .admin-subtitle {
            color: #a0aec0;
            font-size: 0.85rem;
        }
        
        .admin-info {
            color: #cbd5e0;
            font-size: 0.85rem;
        }
        
        /* Chat grid - 2x4 layout */
        .chat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            height: calc(100vh - 90px);
        }
        
        /* Individual chat containers - Dark Theme */
        .admin-chat-container {
            background: #2d3748;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            height: 420px;
        }
        
        .admin-chat-container:hover {
            border-color: rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .admin-chat-container .chat-header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: #f7fafc;
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-chat-container .chat-header h2 {
            margin-bottom: 6px;
            font-size: 1rem;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .admin-chat-container .chat-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            color: #cbd5e0;
        }
        
        .status-indicator {
            font-size: 0.9rem;
            color: #718096;
        }
        
        .status-indicator.online {
            color: #48bb78;
        }
        
        .admin-chat-container .chat-messages {
            padding: 15px;
            overflow-y: auto;
            background: #1a202c;
            height: 280px;
        }
        
        .admin-chat-container .chat-input {
            padding: 15px;
            background: #2d3748;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            height: 100px;
        }
        
        .input-wrapper {
            width: 100%;
        }
        
        .input-row {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }
        
        .chat-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: none;
            font-family: inherit;
            box-sizing: border-box;
            background: #1a202c;
            color: #f7fafc;
        }
        
        .chat-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: #2d3748;
        }
        
        .chat-textarea::placeholder {
            color: #718096;
        }
        
        .system-message {
            text-align: center;
            color: #a0aec0;
            font-style: italic;
            padding: 8px;
            background: rgba(160, 174, 192, 0.1);
            border-radius: 6px;
            margin: 8px 0;
            font-size: 0.85rem;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 85%;
            font-size: 0.85rem;
        }
        
        .participant-message {
            background: #4a5568;
            color: #f7fafc;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-message {
            background: #667eea;
            color: #f7fafc;
            margin-left: auto;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
            font-size: 0.75rem;
        }
        
        .sender {
            font-weight: 600;
        }
        
        .timestamp {
            opacity: 0.7;
        }
        
        .message-text {
            line-height: 1.3;
            white-space: pre-line;
        }
        
        /* Responsive design */
        @media (max-width: 1400px) {
            .chat-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .chat-grid {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(8, 1fr);
            }
            
            .admin-header {
                padding: 10px 15px;
            }
            
            .admin-header-content {
                flex-direction: column;
                gap: 8px;
            }
            
            .admin-title {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="admin-body">
    <div class="admin-header">
        <div class="admin-header-content">
            <div class="admin-header-left">
                <span class="admin-title">üê≠ Admin Dashboard</span>
                <span class="admin-subtitle">Managing 8 concurrent chat sessions</span>
            </div>
            <div class="admin-header-right">
                <span class="admin-info">Admin: Rajendran D</span>
                <span class="admin-info" id="activeRooms">Active Rooms: 0</span>
            </div>
        </div>
    </div>

    <div class="chat-grid">
        <!-- Room 1 -->
        <div class="admin-chat-container" id="chat-1" data-room="1">
            <div class="chat-header">
                <h2>üí¨ Room 1</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-1">Waiting...</span>
                    <span class="status-indicator" id="status-1">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-1">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-1"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 2 -->
        <div class="admin-chat-container" id="chat-2" data-room="2">
            <div class="chat-header">
                <h2>üí¨ Room 2</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-2">Waiting...</span>
                    <span class="status-indicator" id="status-2">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-2">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-2"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 3 -->
        <div class="admin-chat-container" id="chat-3" data-room="3">
            <div class="chat-header">
                <h2>üí¨ Room 3</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-3">Waiting...</span>
                    <span class="status-indicator" id="status-3">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-3">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 4 -->
        <div class="admin-chat-container" id="chat-4" data-room="4">
            <div class="chat-header">
                <h2>üí¨ Room 4</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-4">Waiting...</span>
                    <span class="status-indicator" id="status-4">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-4">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-4"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 5 -->
        <div class="admin-chat-container" id="chat-5" data-room="5">
            <div class="chat-header">
                <h2>üí¨ Room 5</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-5">Waiting...</span>
                    <span class="status-indicator" id="status-5">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-5">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-5"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 6 -->
        <div class="admin-chat-container" id="chat-6" data-room="6">
            <div class="chat-header">
                <h2>üí¨ Room 6</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-6">Waiting...</span>
                    <span class="status-indicator" id="status-6">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-6">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-6"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 7 -->
        <div class="admin-chat-container" id="chat-7" data-room="7">
            <div class="chat-header">
                <h2>üí¨ Room 7</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-7">Waiting...</span>
                    <span class="status-indicator" id="status-7">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-7">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-7"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 8 -->
        <div class="admin-chat-container" id="chat-8" data-room="8">
            <div class="chat-header">
                <h2>üí¨ Room 8</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-8">Waiting...</span>
                    <span class="status-indicator" id="status-8">‚óã</span>
                </div>
            </div>
            <div class="chat-messages" id="messages-8">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-8"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        const activeRoomsSpan = document.getElementById('activeRooms');
        let activeRooms = 0;

        // Initialize all 8 rooms (1-8)
        for (let i = 1; i <= 8; i++) {
            setupInputUI(i);
        }

        // Connect as admin
        console.log('Connecting as admin...');
        socket.emit('admin-connect');

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function setupInputUI(roomId) {
            const textarea = document.getElementById(`input-${roomId}`);
            
            // Auto-resize textarea
            textarea.addEventListener('input', () => autoResize(textarea));
            
            // Handle Enter key for sending messages
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage(roomId);
                    autoResize(textarea);
                }
            });
        }

        // Admin connection events
        socket.on('admin-connected', (data) => {
            console.log('Admin connected, received data:', data);
            console.log('Number of rooms:', data.rooms ? data.rooms.length : 0);
            
            // Join admin room to receive messages
            socket.join('admin-room');
            
            // Join all specific rooms (1-8) to receive messages
            for (let i = 1; i <= 8; i++) {
                socket.join(`room-${i}`);
            }
            
            // Show existing rooms if any
            if (data.rooms && data.rooms.length > 0) {
                console.log('Processing existing rooms:', data.rooms);
                data.rooms.forEach(room => {
                    console.log('Processing room:', room);
                    updateRoomParticipant(room.roomId, room.participant);
                    
                    // Show existing messages
                    if (room.messages && room.messages.length > 0) {
                        console.log(`Room ${room.roomId} has ${room.messages.length} messages`);
                        const messagesContainer = document.getElementById(`messages-${room.roomId}`);
                        if (messagesContainer) {
                            messagesContainer.innerHTML = '';
                            room.messages.forEach(message => {
                                addMessageToWindow(room.roomId, message);
                            });
                        }
                    }
                });
            } else {
                console.log('No existing rooms found');
            }
            
            updateActiveRooms();
        });

        // New participant joined
        socket.on('new-participant', (data) => {
            console.log('New participant received:', data);
            console.log('Room ID:', data.roomId, 'Type:', typeof data.roomId);
            console.log('Participant:', data.participant);
            updateRoomParticipant(data.roomId, data.participant);
            updateActiveRooms();
        });

        // Admin message from participant
        socket.on('admin-message', (data) => {
            console.log('Admin message received:', data);
            addMessageToWindow(data.roomId, data.message);
        });

        // New message received
        socket.on('new-message', (data) => {
            console.log('New message received:', data);
            if (data.roomId && data.message) {
                addMessageToWindow(data.roomId, data.message);
            }
        });

        // All messages
        socket.on('message', (data) => {
            console.log('Message received:', data);
            if (data.roomId && data.message) {
                addMessageToWindow(data.roomId, data.message);
            }
        });

        // Disconnect
        socket.on('disconnect', () => {
            console.log('Connection lost');
        });

        function updateRoomParticipant(roomId, participant) {
            console.log('Updating room participant:', roomId, participant);
            console.log('Looking for elements with IDs: participant-' + roomId, 'status-' + roomId, 'messages-' + roomId);
            
            const participantSpan = document.getElementById(`participant-${roomId}`);
            const statusIndicator = document.getElementById(`status-${roomId}`);
            const messagesContainer = document.getElementById(`messages-${roomId}`);
            
            console.log('Found elements:', { participantSpan, statusIndicator, messagesContainer });
            
            if (participantSpan) {
                participantSpan.textContent = participant.name;
                participantSpan.style.color = '#48bb78';
                console.log('Updated participant span to:', participant.name);
            } else {
                console.log('Participant span not found for room:', roomId);
            }
            
            if (statusIndicator) {
                statusIndicator.textContent = '‚óè';
                statusIndicator.className = 'status-indicator online';
                console.log('Updated status indicator');
            } else {
                console.log('Status indicator not found for room:', roomId);
            }
            
            if (messagesContainer) {
                // Clear "No participant yet" message
                const systemMessage = messagesContainer.querySelector('.system-message');
                if (systemMessage && systemMessage.textContent === 'No participant yet') {
                    systemMessage.remove();
                    console.log('Removed "No participant yet" message');
                }
            } else {
                console.log('Messages container not found for room:', roomId);
            }
        }

        function addMessageToWindow(roomId, message) {
            const messagesContainer = document.getElementById(`messages-${roomId}`);
            if (!messagesContainer) return;

            const messageElement = document.createElement('div');
            messageElement.className = `message ${message.isAdmin ? 'admin-message' : 'participant-message'}`;
            
            // Preserve newlines in message text
            const formattedText = message.text.replace(/\n/g, '<br>');
            
            // Format timestamp to local time
            const timestamp = new Date(message.timestamp).toLocaleTimeString();
            
            messageElement.innerHTML = `
                <div class="message-header">
                    <span class="sender">${message.sender}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="message-text">${formattedText}</div>
            `;

            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage(roomId) {
            const input = document.getElementById(`input-${roomId}`);
            const message = input.value.trim();
            
            if (message) {
                // Create admin message object
                const adminMessage = {
                    id: Date.now(),
                    text: message,
                    sender: 'Rajendran D',
                    timestamp: new Date().toLocaleTimeString(),
                    isAdmin: true
                };
                
                // Immediately show the message in admin interface for instant feedback
                addMessageToWindow(roomId, adminMessage);
                
                // Send to server
                socket.emit('send-message', { text: message, roomId });
                
                // Clear input and reset UI
                input.value = '';
                autoResize(input);
            }
        }

        function updateActiveRooms() {
            // Count rooms with active participants
            let activeCount = 0;
            for (let i = 1; i <= 8; i++) {
                const participantSpan = document.getElementById(`participant-${i}`);
                if (participantSpan && participantSpan.textContent !== 'Waiting...') {
                    activeCount++;
                }
            }
            activeRooms = activeCount;
            activeRoomsSpan.textContent = `Active Rooms: ${activeRooms}`;
        }
    </script>
</body>
</html> 