<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Anonymice Chat</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Admin dashboard styles - Dark Theme */
        .admin-body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            height: 100vh;
            margin: 0;
            padding: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        .admin-header {
            background: rgba(45, 55, 72, 0.95);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #e2e8f0;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .admin-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #f7fafc;
        }
        
        .admin-subtitle {
            color: #a0aec0;
            font-size: 0.85rem;
        }
        
        .admin-info {
            color: #cbd5e0;
            font-size: 0.85rem;
        }
        
        .notification-status {
            color: #a0aec0;
            font-size: 0.75rem;
            margin-left: 15px;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        /* Service Switch Styles */
        .service-switch {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a5568;
            transition: 0.3s;
            border-radius: 24px;
            border: 2px solid #2d3748;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: #e2e8f0;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #48bb78;
            border-color: #38a169;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .switch-label {
            color: #a0aec0;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
        }
        
        /* Chat grid - 2x4 layout */
        .chat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            max-width: 1600px;
            margin: 0 auto;
            height: calc(100vh - 80px);
        }
        
        /* Individual chat containers - Dark Theme */
        .admin-chat-container {
            background: #2d3748;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            height: 400px;
            position: relative;
        }
        
        /* Inactive/No activity state */
        .admin-chat-container.inactive {
            background: #1a202c;
            border-color: rgba(102, 126, 234, 0.1);
            opacity: 0.6;
        }
        
        .admin-chat-container.inactive .chat-header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        }
        
        .admin-chat-container.inactive .chat-messages {
            background: #0f1419;
        }
        
        .admin-chat-container.inactive .chat-input {
            background: #1a202c;
        }
        
        /* Unread messages state - Bright and attention-grabbing */
        .admin-chat-container.has-unread {
            background: #2d3748;
            border-color: #f6ad55;
            border-width: 3px;
            box-shadow: 0 20px 40px rgba(246, 173, 85, 0.3);
            animation: pulse-attention 2s infinite;
        }
        
        .admin-chat-container.has-unread .chat-header {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            border-bottom: 2px solid #f6ad55;
        }
        
        .admin-chat-container.has-unread .chat-header h2 {
            color: #ffffff;
            font-weight: 700;
        }
        
        .admin-chat-container.has-unread .chat-info {
            color: #ffffff;
        }
        
        /* Active but no new messages state */
        .admin-chat-container.active {
            background: #2d3748;
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        /* Participant left state - Red highlighting */
        .admin-chat-container.participant-left {
            background: #2d3748;
            border-color: #e53e3e;
            border-width: 3px;
            box-shadow: 0 20px 40px rgba(229, 62, 62, 0.3);
            animation: pulse-left 2s infinite;
        }
        
        .admin-chat-container.participant-left .chat-header {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            border-bottom: 2px solid #e53e3e;
        }
        
        .admin-chat-container.participant-left .chat-header h2 {
            color: #ffffff;
            font-weight: 700;
        }
        
        .admin-chat-container.participant-left .chat-info {
            color: #ffffff;
        }
        
        /* Pulse animation for left tiles */
        @keyframes pulse-left {
            0% {
                box-shadow: 0 20px 40px rgba(229, 62, 62, 0.3);
            }
            50% {
                box-shadow: 0 20px 40px rgba(229, 62, 62, 0.6);
            }
            100% {
                box-shadow: 0 20px 40px rgba(229, 62, 62, 0.3);
            }
        }
        
        .admin-chat-container:hover {
            border-color: rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* Pulse animation for unread tiles */
        @keyframes pulse-attention {
            0% {
                box-shadow: 0 20px 40px rgba(246, 173, 85, 0.3);
            }
            50% {
                box-shadow: 0 20px 40px rgba(246, 173, 85, 0.6);
            }
            100% {
                box-shadow: 0 20px 40px rgba(246, 173, 85, 0.3);
            }
        }
        
        .admin-chat-container .chat-header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: #f7fafc;
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-chat-container .chat-header h2 {
            margin-bottom: 6px;
            font-size: 1rem;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .admin-chat-container .chat-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            color: #cbd5e0;
        }
        
        .status-indicator {
            font-size: 0.9rem;
            color: #718096;
        }
        
        .status-indicator.online {
            color: #48bb78;
        }
        
        .admin-chat-container .chat-messages {
            padding: 15px;
            overflow-y: auto;
            background: #1a202c;
            height: 260px;
        }
        
        .admin-chat-container .chat-input {
            padding: 15px;
            background: #2d3748;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            height: 100px;
        }
        
        .input-wrapper {
            width: 100%;
        }
        
        .input-row {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }
        
        .chat-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: none;
            font-family: inherit;
            box-sizing: border-box;
            background: #1a202c;
            color: #f7fafc;
        }
        
        .chat-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: #2d3748;
        }
        
        .chat-textarea::placeholder {
            color: #718096;
        }
        
        .emoji-panel {
            display: flex;
            gap: 3px;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 4px;
            justify-content: center;
            height: 25px;
            align-items: center;
        }
        
        .emoji-btn {
            background: none;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            padding: 2px 3px;
            border-radius: 3px;
            transition: background-color 0.2s;
            color: #cbd5e0;
        }
        
        .emoji-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .emoji-btn:active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .cleanup-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .cleanup-btn:hover {
            background: #059669;
        }
        
        .cleanup-btn:active {
            background: #047857;
        }
        
        .stop-chat-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: background-color 0.2s;
            margin-left: 5px;
        }
        
        .stop-chat-btn:hover {
            background: #c53030;
        }
        
        .stop-chat-btn:active {
            background: #a52a2a;
        }
        
        .system-message {
            text-align: center;
            color: #a0aec0;
            font-style: italic;
            padding: 8px;
            background: rgba(160, 174, 192, 0.1);
            border-radius: 6px;
            margin: 8px 0;
            font-size: 0.85rem;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 85%;
            font-size: 0.85rem;
        }
        
        .participant-message {
            background: #4a5568;
            color: #f7fafc;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-message {
            background: #667eea;
            color: #f7fafc;
            margin-left: auto;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
            font-size: 0.75rem;
        }
        
        .sender {
            font-weight: 600;
        }
        
        .timestamp {
            opacity: 0.7;
        }
        
        .message-text {
            line-height: 1.3;
            white-space: pre-line;
        }
        
        /* Responsive design */
        @media (max-width: 1400px) {
            .chat-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .chat-grid {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(8, 1fr);
            }
            
            .admin-header {
                padding: 10px 15px;
            }
            
            .admin-header-content {
                flex-direction: column;
                gap: 8px;
            }
            
            .admin-title {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="admin-body">
            <div class="admin-header">
            <div class="admin-header-content">
                <div class="admin-header-left">
                    <span class="admin-title">🐭 Admin Dashboard</span>
                    <span class="admin-subtitle">Managing 8 concurrent chat sessions</span>
                </div>
                <div class="admin-header-right">
                    <span class="admin-info">Admin: Rajendran D</span>
                    <span class="admin-info" id="activeRooms">Active Rooms: 0</span>
                    <span class="notification-status">🔇 Notifications muted (page active)</span>
                    <div class="service-switch">
                        <label class="switch">
                            <input type="checkbox" id="serviceToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label" id="switchLabel">Service: OFF</span>
                    </div>
                </div>
            </div>
        </div>

    <div class="chat-grid">
        <!-- Room 1 -->
        <div class="admin-chat-container" id="chat-1" data-room="1">
            <div class="chat-header">
                <h2>💬 Room 1</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-1">Waiting...</span>
                    <span class="status-indicator" id="status-1">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-1" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-1" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-1">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(1, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-1" tabindex="1"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 2 -->
        <div class="admin-chat-container" id="chat-2" data-room="2">
            <div class="chat-header">
                <h2>💬 Room 2</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-2">Waiting...</span>
                    <span class="status-indicator" id="status-2">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-2" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-2" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-2">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(2, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-2" tabindex="2"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 3 -->
        <div class="admin-chat-container" id="chat-3" data-room="3">
            <div class="chat-header">
                <h2>💬 Room 3</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-3">Waiting...</span>
                    <span class="status-indicator" id="status-3">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-3" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-3" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-3">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(3, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-3" tabindex="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 4 -->
        <div class="admin-chat-container" id="chat-4" data-room="4">
            <div class="chat-header">
                <h2>💬 Room 4</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-4">Waiting...</span>
                    <span class="status-indicator" id="status-4">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-4" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-4" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-4">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(4, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-4" tabindex="4"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 5 -->
        <div class="admin-chat-container" id="chat-5" data-room="5">
            <div class="chat-header">
                <h2>💬 Room 5</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-5">Waiting...</span>
                    <span class="status-indicator" id="status-5">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-5" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-5" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-5">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(5, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-5" tabindex="5"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 6 -->
        <div class="admin-chat-container" id="chat-6" data-room="6">
            <div class="chat-header">
                <h2>💬 Room 6</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-6">Waiting...</span>
                    <span class="status-indicator" id="status-6">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-6" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-6" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-6">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(6, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-6" tabindex="6"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 7 -->
        <div class="admin-chat-container" id="chat-7" data-room="7">
            <div class="chat-header">
                <h2>💬 Room 7</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-7">Waiting...</span>
                    <span class="status-indicator" id="status-7">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-7" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-7" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-7">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(7, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-7" tabindex="7"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room 8 -->
        <div class="admin-chat-container" id="chat-8" data-room="8">
            <div class="chat-header">
                <h2>💬 Room 8</h2>
                <div class="chat-info">
                    <span class="participant-name" id="participant-8">Waiting...</span>
                    <span class="status-indicator" id="status-8">○</span>
                </div>
                <button class="cleanup-btn" id="cleanup-8" style="display: none;">🧹 Clean</button>
                <button class="stop-chat-btn" id="stop-chat-8" style="display: none;">🚫 Stop Chatting</button>
            </div>
            <div class="chat-messages" id="messages-8">
                <div class="system-message">No participant yet</div>
            </div>
            <div class="chat-input">
                <div class="emoji-panel">
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '😊')">😊</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '😞')">😞</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '👍')">👍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '👎')">👎</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '😍')">😍</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '❤️')">❤️</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '💔')">💔</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '💯')">💯</button>
                    <button class="emoji-btn" tabindex="-1" onclick="insertEmoji(8, '🙏')">🙏</button>
                </div>
                <div class="input-wrapper">
                    <div class="input-row">
                        <div style="position: relative; flex: 1;">
                            <textarea class="chat-textarea" rows="2" placeholder="Type your message... (Enter to send, Shift+Enter for new line)" id="input-8" tabindex="8"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio for notifications -->
            <audio id="pingSound" preload="auto">
            <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
        </audio>
        
        <audio id="enterSound" preload="auto">
            <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
        </audio>

    <script>
        const socket = io();
        const activeRoomsSpan = document.getElementById('activeRooms');
        const pingSound = document.getElementById('pingSound');
        const enterSound = document.getElementById('enterSound');
        let activeRooms = 0;
        
        // Unread message tracking
        const unreadMessages = new Map(); // roomId -> count
        const lastReadTime = new Map(); // roomId -> timestamp

        // Initialize all 8 rooms (1-8)
        for (let i = 1; i <= 8; i++) {
            setupInputUI(i);
            setupCleanupButton(i);
            setupTileClickHandler(i);
        }
        
        // Initialize tile states
        initializeTileStates();

        // Connect as admin
        console.log('🔐 Connecting as admin...');
        socket.emit('admin-connect');

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function setupInputUI(roomId) {
            const textarea = document.getElementById(`input-${roomId}`);
            
            // Auto-resize textarea
            textarea.addEventListener('input', () => autoResize(textarea));
            
            // Handle Enter key for sending messages
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage(roomId);
                    autoResize(textarea);
                }
            });
        }

        // Admin connection events
        socket.on('admin-connected', (data) => {
            console.log('✅ Admin connected, received data:', data);
            console.log('Number of rooms:', data.rooms ? data.rooms.length : 0);
            
            // Join all specific rooms (1-8) to receive messages
            for (let i = 1; i <= 8; i++) {
                socket.join(`room-${i}`);
            }
            
            // Show existing rooms if any
            if (data.rooms && data.rooms.length > 0) {
                console.log('Processing existing rooms:', data.rooms);
                data.rooms.forEach(room => {
                    console.log('Processing room:', room);
                    updateRoomParticipant(room.roomId, room.participant);
                    
                    // Show existing messages
                    if (room.messages && room.messages.length > 0) {
                        console.log(`Room ${room.roomId} has ${room.messages.length} messages`);
                        const messagesContainer = document.getElementById(`messages-${room.roomId}`);
                        if (messagesContainer) {
                            messagesContainer.innerHTML = '';
                            room.messages.forEach(message => {
                                addMessageToWindow(room.roomId, message);
                            });
                        }
                    }
                });
            } else {
                console.log('No existing rooms found');
            }
            
            updateActiveRooms();
        });

        // New participant joined
        socket.on('new-participant', (data) => {
            console.log('🎉 NEW PARTICIPANT EVENT RECEIVED!');
            console.log('New participant received:', data);
            console.log('Room ID:', data.roomId, 'Type:', typeof data.roomId);
            console.log('Participant:', data.participant);
            
            // Force update with alert for testing
            if (data.roomId && data.participant) {
                updateRoomParticipant(data.roomId, data.participant);
                updateRoomStatus(data.roomId, 'active');
                updateActiveRooms();
                
                // Mark tile as active (no unread messages yet)
                updateTileState(data.roomId, 'active');
                
                // Play enter sound (double-tone) for new participant
                playEnterSound();
                
                console.log('✅ Update functions called successfully');
            } else {
                console.log('❌ Missing roomId or participant data');
            }
        });

        // Admin message from participant
        socket.on('admin-message', (data) => {
            console.log('Admin message received:', data);
            addMessageToWindow(data.roomId, data.message);
            
            // Mark message as unread (only if it's from participant, not admin)
            if (data.message && !data.message.isAdmin) {
                markMessageAsUnread(data.roomId);
            }
            
            // Play ping sound for new messages
            playPingSound();
        });

        // Participant left room
        socket.on('participant-left', (data) => {
            console.log('🔌 ADMIN RECEIVED participant-left event:', data);
            console.log('🔌 Room ID:', data.roomId);
            console.log('🔌 Participant:', data.participant);
            console.log('🔌 Message:', data.message);
            
            addMessageToWindow(data.roomId, data.message);
            updateRoomStatus(data.roomId, 'left');
            
            // Highlight tile to notify admin that participant left
            updateTileState(data.roomId, 'participant-left');
            
            // Play exit sound for participant leaving
            playExitSound();
            
            console.log('🔌 Admin processing complete for participant-left event');
        });

        // Room cleaned
        socket.on('room-cleaned', (data) => {
            console.log('Room cleaned:', data);
            addMessageToWindow(data.roomId, data.message);
            updateRoomStatus(data.roomId, 'cleaned');
            
            // Reset tile state to inactive
            updateTileState(data.roomId, 'inactive');
            unreadMessages.set(data.roomId, 0);
            
            // Clear the messages container after a brief delay to show the cleanup message
            setTimeout(() => {
                const messagesContainer = document.getElementById(`messages-${data.roomId}`);
                if (messagesContainer) {
                    messagesContainer.innerHTML = '<div class="system-message">No participant yet</div>';
                }
            }, 2000);
        });

        // New message received
        socket.on('new-message', (data) => {
            console.log('New message received:', data);
            if (data.roomId && data.message) {
                addMessageToWindow(data.roomId, data.message);
            }
        });

        // All messages
        socket.on('message', (data) => {
            console.log('Message received:', data);
            if (data.roomId && data.message) {
                addMessageToWindow(data.roomId, data.message);
            }
        });

        // Disconnect
        socket.on('disconnect', () => {
            console.log('Connection lost');
        });

        function updateRoomParticipant(roomId, participant) {
            console.log('Updating room participant:', roomId, participant);
            console.log('Looking for elements with IDs: participant-' + roomId, 'status-' + roomId, 'messages-' + roomId);
            
            const participantSpan = document.getElementById(`participant-${roomId}`);
            const statusIndicator = document.getElementById(`status-${roomId}`);
            const messagesContainer = document.getElementById(`messages-${roomId}`);
            
            console.log('Found elements:', { participantSpan, statusIndicator, messagesContainer });
            
            if (participantSpan) {
                participantSpan.textContent = participant.name;
                participantSpan.style.color = '#48bb78';
                console.log('Updated participant span to:', participant.name);
            } else {
                console.log('Participant span not found for room:', roomId);
            }
            
            if (statusIndicator) {
                statusIndicator.textContent = '●';
                statusIndicator.className = 'status-indicator online';
                console.log('Updated status indicator');
            } else {
                console.log('Status indicator not found for room:', roomId);
            }
            
            if (messagesContainer) {
                // Clear "No participant yet" message
                const systemMessage = messagesContainer.querySelector('.system-message');
                if (systemMessage && systemMessage.textContent === 'No participant yet') {
                    systemMessage.remove();
                    console.log('Removed "No participant yet" message');
                }
            } else {
                console.log('Messages container not found for room:', roomId);
            }
        }

        function addMessageToWindow(roomId, message) {
            const messagesContainer = document.getElementById(`messages-${roomId}`);
            if (!messagesContainer) return;

            const messageElement = document.createElement('div');
            messageElement.className = `message ${message.isAdmin ? 'admin-message' : 'participant-message'}`;
            
            // Preserve newlines in message text
            const formattedText = message.text.replace(/\n/g, '<br>');
            
            // Debug timestamp
            console.log('📅 Admin received timestamp:', message.timestamp, 'Type:', typeof message.timestamp);
            
            // Format timestamp to local time with error handling
            let timestamp;
            try {
                timestamp = new Date(message.timestamp).toLocaleTimeString();
            } catch (error) {
                console.log('❌ Timestamp error in admin:', error);
                timestamp = new Date().toLocaleTimeString(); // Fallback
            }
            
            messageElement.innerHTML = `
                <div class="message-header">
                    <span class="sender">${message.sender}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="message-text">${formattedText}</div>
            `;

            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage(roomId) {
            const input = document.getElementById(`input-${roomId}`);
            const message = input.value.trim();
            
            if (message) {
                // Create admin message object
                const adminMessage = {
                    id: Date.now(),
                    text: message,
                    sender: 'Rajendran D',
                    timestamp: new Date().toISOString(),
                    isAdmin: true
                };
                
                // Immediately show the message in admin interface for instant feedback
                addMessageToWindow(roomId, adminMessage);
                
                // Send to server
                socket.emit('send-message', { text: message, roomId });
                
                // Clear input and reset UI
                input.value = '';
                autoResize(input);
                
                // Mark room as read when admin sends a message
                markRoomAsRead(roomId);
            }
        }

        function updateActiveRooms() {
            // Count rooms with active participants
            let activeCount = 0;
            for (let i = 1; i <= 8; i++) {
                const participantSpan = document.getElementById(`participant-${i}`);
                if (participantSpan && participantSpan.textContent !== 'Waiting...') {
                    activeCount++;
                }
            }
            activeRooms = activeCount;
            activeRoomsSpan.textContent = `Active Rooms: ${activeRooms}`;
        }
        
        // Tile state management functions
        function updateTileState(roomId, state) {
            const tile = document.getElementById(`chat-${roomId}`);
            if (!tile) return;
            
            // Remove all state classes
            tile.classList.remove('inactive', 'active', 'has-unread', 'participant-left');
            
            // Add the new state class
            tile.classList.add(state);
            
            console.log(`🎨 Tile ${roomId} state updated to: ${state}`);
        }
        
        function markMessageAsUnread(roomId) {
            const currentCount = unreadMessages.get(roomId) || 0;
            unreadMessages.set(roomId, currentCount + 1);
            
            // Update tile to show unread state
            updateTileState(roomId, 'has-unread');
            
            console.log(`📬 Room ${roomId} has ${currentCount + 1} unread messages`);
        }
        
        function markRoomAsRead(roomId) {
            unreadMessages.set(roomId, 0);
            lastReadTime.set(roomId, Date.now());
            
            // Update tile to show active state (no unread messages)
            updateTileState(roomId, 'active');
            
            console.log(`✅ Room ${roomId} marked as read`);
        }
        
        function initializeTileStates() {
            // Set all tiles to inactive initially
            for (let i = 1; i <= 8; i++) {
                updateTileState(i, 'inactive');
            }
        }
        
        function setupTileClickHandler(roomId) {
            const tile = document.getElementById(`chat-${roomId}`);
            if (!tile) return;
            
            tile.addEventListener('click', () => {
                // Check if tile is in participant-left state
                if (tile.classList.contains('participant-left')) {
                    // Show cleanup button when admin clicks on left participant tile
                    const cleanupBtn = document.getElementById(`cleanup-${roomId}`);
                    if (cleanupBtn) {
                        cleanupBtn.style.display = 'block';
                    }
                    // Keep the red highlighting until admin cleans the room
                    return;
                }
                
                // Mark room as read when admin clicks on it (for unread messages)
                markRoomAsRead(roomId);
                
                // Focus on the input area for immediate typing
                const textarea = document.getElementById(`input-${roomId}`);
                if (textarea) {
                    textarea.focus();
                }
            });
        }

        function insertEmoji(roomId, emoji) {
            const textarea = document.getElementById(`input-${roomId}`);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            
            textarea.value = text.substring(0, start) + emoji + text.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
            textarea.focus();
            autoResize(textarea);
        }

        function setupCleanupButton(roomId) {
            const cleanupBtn = document.getElementById(`cleanup-${roomId}`);
            if (cleanupBtn) {
                cleanupBtn.addEventListener('click', () => {
                    if (confirm(`Are you sure you want to clean Room ${roomId}?`)) {
                        // Copy chat transcript to clipboard before cleaning
                        copyChatTranscriptToClipboard(roomId);
                        
                                                // Send cleanup request to server
                        socket.emit('cleanup-room', { roomId });
                        cleanupBtn.style.display = 'none';
                    }
                });
                
                // Setup stop chat button handler
                const stopChatBtn = document.getElementById(`stop-chat-${roomId}`);
                if (stopChatBtn) {
                    stopChatBtn.addEventListener('click', () => {
                        if (confirm(`Are you sure you want to stop chatting with the participant in Room ${roomId}?`)) {
                            // Send stop chat request to server
                            socket.emit('stop-chat', { roomId });
                            stopChatBtn.style.display = 'none';
                        }
                    });
                }
            }
        }

        function copyChatTranscriptToClipboard(roomId) {
            const messagesContainer = document.getElementById(`messages-${roomId}`);
            const participantSpan = document.getElementById(`participant-${roomId}`);
            
            if (!messagesContainer) return;
            
            // Get participant name
            const participantName = participantSpan ? participantSpan.textContent : 'Unknown';
            
            // Format the transcript
            let transcript = `📋 Chat Transcript - Room ${roomId}\n`;
            transcript += `👤 Participant: ${participantName}\n`;
            transcript += `📅 Date: ${new Date().toLocaleDateString()}\n`;
            transcript += `⏰ Time: ${new Date().toLocaleTimeString()}\n`;
            transcript += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n`;
            
            // Get all messages
            const messages = messagesContainer.querySelectorAll('.message');
            messages.forEach((msgElement) => {
                const senderElement = msgElement.querySelector('.sender');
                const timestampElement = msgElement.querySelector('.timestamp');
                const textElement = msgElement.querySelector('.message-text');
                
                if (senderElement && timestampElement && textElement) {
                    const sender = senderElement.textContent;
                    const timestamp = timestampElement.textContent;
                    const text = textElement.textContent;
                    
                    const senderLabel = sender === 'Rajendran D' ? '👨‍💼 Admin' : '👤 User';
                    transcript += `${timestamp} ${senderLabel}: ${text}\n\n`;
                }
            });
            
            transcript += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;
            transcript += `📊 Total Messages: ${messages.length}\n`;
            transcript += `✅ Room cleaned and ready for next participant`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(transcript).then(() => {
                console.log('📋 Chat transcript copied to clipboard');
                // Show a brief notification
                showNotification(`Chat transcript for Room ${roomId} copied to clipboard!`);
            }).catch(err => {
                console.error('❌ Failed to copy to clipboard:', err);
                // Fallback: show transcript in alert
                alert('Chat transcript copied to clipboard:\n\n' + transcript.substring(0, 500) + '...');
            });
        }

        // Track page visibility and focus state
        let isPageVisible = true;
        let isPageFocused = true;

        // Listen for page visibility changes
        document.addEventListener('visibilitychange', () => {
            isPageVisible = !document.hidden;
            console.log('Page visibility changed:', isPageVisible ? 'visible' : 'hidden');
            updateAdminStatus();
        });

        // Listen for window focus/blur events
        window.addEventListener('focus', () => {
            isPageFocused = true;
            console.log('Page focused');
            updateNotificationStatus();
            updateAdminStatus();
        });

        window.addEventListener('blur', () => {
            isPageFocused = false;
            console.log('Page lost focus');
            updateNotificationStatus();
            updateAdminStatus();
        });

        // Update admin status and notify all users
        function updateAdminStatus() {
            const isAdminActive = isPageVisible && isPageFocused;
            console.log('Admin status updated:', isAdminActive ? 'active' : 'away');
            
            // Emit admin status to server
            socket.emit('admin-status-change', { 
                isActive: isAdminActive,
                timestamp: new Date().toISOString()
            });
        }

        // Update notification status indicator
        function updateNotificationStatus() {
            const statusIndicator = document.querySelector('.notification-status');
            if (statusIndicator) {
                if (isPageVisible && isPageFocused) {
                    statusIndicator.textContent = '🔇 Notifications muted (page active)';
                    statusIndicator.style.color = '#a0aec0';
                } else {
                    statusIndicator.textContent = '🔊 Notifications active';
                    statusIndicator.style.color = '#10b981';
                }
            }
        }

        // Initialize notification status after variables are declared
        updateNotificationStatus();

        // Initialize service toggle
        const serviceToggle = document.getElementById('serviceToggle');
        const switchLabel = document.getElementById('switchLabel');
        
        // Set initial state (OFF by default)
        serviceToggle.checked = false;
        switchLabel.textContent = 'Service: OFF';
        
        // Handle service toggle
        serviceToggle.addEventListener('change', () => {
            const isEnabled = serviceToggle.checked;
            switchLabel.textContent = isEnabled ? 'Service: ON' : 'Service: OFF';
            
            // Send toggle event to server
            socket.emit('toggle-service', { enabled: isEnabled });
            
            console.log(`🔌 Service ${isEnabled ? 'enabled' : 'disabled'}`);
        });

        function showNotification(message) {
            // Only show notification if page is not visible or not focused
            if (isPageVisible && isPageFocused) {
                console.log('Notification muted - admin page is active and focused');
                return;
            }

            // Create a temporary notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation CSS
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 3000);
        }

        function updateRoomStatus(roomId, status) {
            const participantSpan = document.getElementById(`participant-${roomId}`);
            const statusIndicator = document.getElementById(`status-${roomId}`);
            const cleanupBtn = document.getElementById(`cleanup-${roomId}`);
            const stopChatBtn = document.getElementById(`stop-chat-${roomId}`);
            
            console.log(`🔌 updateRoomStatus called for room ${roomId} with status: ${status}`);
            console.log(`🔌 Elements found:`, {
                participantSpan: !!participantSpan,
                statusIndicator: !!statusIndicator,
                cleanupBtn: !!cleanupBtn,
                stopChatBtn: !!stopChatBtn
            });
            
            if (status === 'active') {
                if (statusIndicator) {
                    statusIndicator.textContent = '●';
                    statusIndicator.className = 'status-indicator online';
                }
                if (cleanupBtn) {
                    cleanupBtn.style.display = 'none';
                }
                if (stopChatBtn) {
                    stopChatBtn.style.display = 'inline-block';
                }
            } else if (status === 'left') {
                console.log(`🔌 Setting room ${roomId} to LEFT status`);
                if (participantSpan) {
                    participantSpan.textContent = 'Left';
                    participantSpan.style.color = '#ef4444';
                    console.log(`🔌 Updated participant span for room ${roomId}`);
                }
                if (statusIndicator) {
                    statusIndicator.textContent = '○';
                    statusIndicator.className = 'status-indicator';
                    console.log(`🔌 Updated status indicator for room ${roomId}`);
                }
                if (cleanupBtn) {
                    cleanupBtn.style.display = 'inline-block';
                    console.log(`🔌 SHOWING cleanup button for room ${roomId}`);
                } else {
                    console.log(`🔌 ❌ CLEANUP BUTTON NOT FOUND for room ${roomId}`);
                }
                if (stopChatBtn) {
                    stopChatBtn.style.display = 'none';
                    console.log(`🔌 Hiding stop chat button for room ${roomId}`);
                }
            } else if (status === 'cleaned') {
                if (participantSpan) {
                    participantSpan.textContent = 'Ready';
                    participantSpan.style.color = '#10b981';
                }
                if (statusIndicator) {
                    statusIndicator.textContent = '○';
                    statusIndicator.className = 'status-indicator';
                }
                if (cleanupBtn) {
                    cleanupBtn.style.display = 'none';
                }
                if (stopChatBtn) {
                    stopChatBtn.style.display = 'none';
                }
            }
        }

                function playPingSound() {
            // Only play sound if page is not visible or not focused
            if (isPageVisible && isPageFocused) {
                console.log('Audio muted - admin page is active and focused');
                return;
            }

            try {
                // Create Web Audio API context
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);

                console.log('Ping sound played');
            } catch (error) {
                console.log('Could not play ping sound:', error);
                // Fallback to audio element
                try {
                    pingSound.currentTime = 0;
                    pingSound.play();
                } catch (fallbackError) {
                    console.log('Fallback audio also failed:', fallbackError);
                }
            }
        }
        
        function playEnterSound() {
            // Only play sound if page is not visible or not focused
            if (isPageVisible && isPageFocused) {
                console.log('Audio muted - admin page is active and focused');
                return;
            }

            try {
                // Create Web Audio API context for positive ascending tone
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create ascending tone (positive entry sound)
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Start low and ascend (positive feeling)
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.4);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);

                console.log('Enter sound (ascending tone) played');
            } catch (error) {
                console.log('Could not play enter sound:', error);
                // Fallback to audio element
                try {
                    enterSound.currentTime = 0;
                    enterSound.play();
                } catch (fallbackError) {
                    console.log('Fallback audio also failed:', fallbackError);
                }
            }
        }

        function playExitSound() {
            // Only play sound if page is not visible or not focused
            if (isPageVisible && isPageFocused) {
                console.log('Audio muted - admin page is active and focused');
                return;
            }

            try {
                // Create Web Audio API context for negative descending tone
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create descending tone (negative exit sound)
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Start high and descend (negative feeling)
                oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.4);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);

                console.log('Exit sound (descending tone) played');
            } catch (error) {
                console.log('Could not play exit sound:', error);
                // Fallback to audio element
                try {
                    enterSound.currentTime = 0;
                    enterSound.play();
                } catch (fallbackError) {
                    console.log('Fallback audio also failed:', fallbackError);
                }
            }
        }



    </script>
</body>
</html> 